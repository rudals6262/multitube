import"./styles.css";console.log("Hello, Webpack with CSS!");let player,currentEditingSlideIndex,checkEndInterval,slideQueue=[],videoDuration=0,currentZoomLevel=1,originalTrackWidth=null,slideIdCounter=0;function createUniqueSlideId(){return"slide_"+slideIdCounter++}if(!window.YT){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}function onYouTubeIframeAPIReady(){console.log("YouTube IFrame API is ready"),player=new YT.Player("videoPreview",{height:"300",width:"100%",events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function resetMediabox(){showMediaButtons()}function addVideoInputFields(){document.getElementById("mediabox-content").innerHTML='\n        <div class="video-container">\n            <div class="video-frame" style="display: none;">\n                <div id="videoPreview"></div>\n            </div>\n            <div class="time-slider-wrapper">\n                <div class="time-slider-container" style="display: none; overflow-x: auto;">\n                    <div class="slider-track" style="width: 100%;">\n                        <div class="slider-range"></div>\n                        <div class="slider-left-thumb" id="startThumb"></div>\n                        <div class="slider-right-thumb" id="endThumb"></div>\n                        <div class="current-time-indicator" id="currentTimeIndicator"></div>\n                    </div>\n                </div>\n            </div>\n        </div>    \n        <div class="input-group">\n            <input type="text" id="videoLink" placeholder="YouTube 링크" onclick="this.value=\'\'" oninput="handleVideoLinkInput()">\n            <div class="plus-minus-buttons" style="display: none;">\n                <button onclick="zoomOut()">-</button>\n                <button onclick="zoomIn()">+</button>\n            </div>\n        </div>\n        <div class="action-buttons">\n            <button class="media-select" onclick="resetMediabox()">미디어 선택</button>\n            <div class="confirm-buttons" style="display: none;">\n                <button class="confirm" onclick="addSlide()">확인</button>\n            </div>\n        </div>\n    '}function extractVideoId(e){let t=null,n=e;if(e.includes("youtube.com/shorts/")){const i=e.match(/youtube\.com\/shorts\/([^?]*)/);i&&i[1]&&(t=i[1],n=`https://www.youtube.com/watch?v=${t}`)}else if(e.includes("music.youtube.com/")){const i=e.match(/music\.youtube\.com\/watch\?v=([^&]*)/);i&&i[1]&&(t=i[1],n=`https://www.youtube.com/watch?v=${t}`)}else if(e.includes("youtube.com/live/")){const i=e.match(/youtube\.com\/live\/([^?]*)/);i&&i[1]&&(t=i[1],n=`https://www.youtube.com/watch?v=${t}`)}else{const n=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=e.match(n);i&&11===i[2].length&&(t=i[2])}return{videoId:t,updatedUrl:n}}async function checkLiveBroadcastStatus(e){try{const t=await fetch(`http://localhost:3000/api/youtube/${e}`);if(!t.ok)throw new Error("Failed to fetch video details");const n=await t.json();if(n.items&&n.items.length>0){const e=n.items[0];if(e.liveStreamingDetails&&e.liveStreamingDetails.concurrentViewers)return!0}return!1}catch(e){return console.error("Error fetching video details:",e),!1}}function handleVideoLinkInput(){const e=document.getElementById("videoLink"),{videoId:t,updatedUrl:n}=extractVideoId(e.value);if(t)resetTrackDisplay(),fetchVideoDuration(t).then((t=>{videoDuration=t,e.value=n,document.querySelector(".video-frame").style.display="block",document.querySelector(".time-slider-wrapper").style.display="block",document.querySelector(".time-slider-container").style.display="block",document.querySelector(".action-buttons .confirm-buttons").style.display="flex",document.querySelector(".input-group .plus-minus-buttons").style.display="inline-block",setupSlider(0,100),forceUpdateSliderLayout()})).catch((e=>{console.error("Error fetching video duration:",e)}));else{const t=slideQueue[currentEditingSlideIndex];t&&(videoDuration=t.videoDuration,e.value=t.videoLink,resetTrackDisplay(),document.querySelector(".video-frame").style.display="block",document.querySelector(".time-slider-wrapper").style.display="block",document.querySelector(".time-slider-container").style.display="block",document.querySelector(".action-buttons .confirm-buttons").style.display="flex",document.querySelector(".input-group .plus-minus-buttons").style.display="inline-block",setupSlider(0,100),forceUpdateSliderLayout())}}function resetTrackDisplay(){const e=document.querySelector(".slider-track"),t=document.getElementById("startThumb"),n=document.getElementById("endThumb"),i=(document.querySelector(".slider-range"),document.getElementById("currentTimeIndicator"));e.style.setProperty("--zoom-factor",1),e.style.setProperty("--tick-base",60),t.style.left="0%",n.style.left="100%",updateSliderRange(),i.style.left="0%",currentZoomLevel=1,adjustSliderTrackWidth()}function fetchVideoDuration(e){return new Promise(((t,n)=>{player&&player.destroy(),player=new YT.Player("videoPreview",{height:"300",width:"100%",videoId:e,events:{onReady:e=>{const i=e.target.getDuration();i?(t(i),setTimeout((()=>{adjustSliderTrackWidth()}),100)):n(new Error("Failed to retrieve video duration"))},onError:e=>{n(e)}}})}))}function adjustSliderTrackWidth(){const e=document.querySelector(".video-frame"),t=document.querySelector(".slider-track"),n=document.querySelector(".time-slider-wrapper"),i=document.querySelector(".time-slider-container");if(e&&t&&n&&i){const o=e.offsetWidth;t.style.width=o-40+"px",n.style.width=`${o}px`,i.style.width=`${o}px`}}function resetVideoFrame(){player&&(player.destroy(),player=null),document.getElementById("videoPreview").innerHTML="",document.querySelector(".video-frame").style.display="none",document.querySelector(".time-slider-container").style.display="none",document.querySelector(".action-buttons").style.display="none",document.querySelector(".plus-minus-buttons").style.display="none"}function onPlayerReady(e){if(console.log("Player is ready"),slideQueue[currentEditingSlideIndex]){const t=slideQueue[currentEditingSlideIndex].startTime;e.target.seekTo(t)}setInterval(updateCurrentTimeIndicator,100)}function onPlayerStateChange(e){e.data==YT.PlayerState.PLAYING&&updateCurrentTimeIndicator()}function setupSlider(e=0,t=100){const n=document.getElementById("startThumb"),i=document.getElementById("endThumb"),o=document.querySelector(".slider-track"),d=document.querySelector(".slider-range"),l=document.getElementById("currentTimeIndicator");function r(e,t){e.style.left=`${t}%`,updateSliderRange()}function s(e,t,d){const l=o.getBoundingClientRect();let r=(t.clientX-l.left)/l.width*100;r=Math.max(0,Math.min(r,100)),d?(r>=parseFloat(i.style.left)&&(r=parseFloat(i.style.left)-1/videoDuration*100),e.style.left=`${r}%`):(r<=parseFloat(n.style.left)&&(r=parseFloat(n.style.left)+1/videoDuration*100),e.style.left=`${r}%`),updateSliderRange();const s=parseFloat(n.style.left),a=parseFloat(i.style.left);if(d)playSegment(s/100*videoDuration,a/100*videoDuration);else{const e=a/100*videoDuration;playSegment(Math.max(0,e-1),e).then((()=>{playSegment(s/100*videoDuration,e)}))}}function a(e){const t=o.getBoundingClientRect();let n=(e.clientX-t.left)/t.width*100;n=Math.max(0,Math.min(n,100)),l.style.left=`${n}%`;const i=n/100*videoDuration;player.seekTo(i),player.playVideo()}function c(e){s(n,e,!0)}function u(e){s(i,e,!1)}function m(){document.removeEventListener("mousemove",c),document.removeEventListener("mousemove",u),document.removeEventListener("mousemove",a)}n&&i&&o&&d&&l?(n.addEventListener("mousedown",(function(e){e.preventDefault(),document.addEventListener("mousemove",c),document.addEventListener("mouseup",m)})),i.addEventListener("mousedown",(function(e){e.preventDefault(),document.addEventListener("mousemove",u),document.addEventListener("mouseup",m)})),l.addEventListener("mousedown",(function(e){e.preventDefault(),document.addEventListener("mousemove",a),document.addEventListener("mouseup",m)})),d.addEventListener("click",(function(e){e.stopPropagation();const t=parseFloat(n.style.left)||0,o=parseFloat(i.style.left)||100;playSegment(t/100*videoDuration,o/100*videoDuration)})),r(n,e),r(i,t),updateSliderRange(),updateCurrentTimeIndicator()):console.error("Slider elements are missing")}function playSegment(e,t){return new Promise((n=>{checkEndInterval&&clearInterval(checkEndInterval),player&&player.seekTo&&"function"==typeof player.seekTo&&(player.seekTo(e),player.playVideo(),checkEndInterval=setInterval((()=>{if(player&&player.getCurrentTime&&"function"==typeof player.getCurrentTime){const i=player.getCurrentTime();updateCurrentTimeIndicator(),i>=t&&(player.pauseVideo(),player.seekTo(e),clearInterval(checkEndInterval),n())}}),100))}))}function moveEnd(e){moveThumb(endThumb,e,!1)}function moveStart(e){moveThumb(startThumb,e,!0)}function stopMove(){document.removeEventListener("mousemove",moveStart),document.removeEventListener("mousemove",moveEnd)}function updateCurrentTimeIndicator(){if(player&&player.getCurrentTime){const e=player.getCurrentTime(),t=document.getElementById("startThumb"),n=document.getElementById("endThumb"),i=document.getElementById("currentTimeIndicator");if(!t||!n||!i)return;const o=parseFloat(t.style.left)/100*videoDuration,d=parseFloat(n.style.left)/100*videoDuration;if(e>=o&&e<=d){const l=(e-o)/(d-o)*100,r=parseFloat(t.style.left),s=r+l/100*(parseFloat(n.style.left)-r);i.style.left=`${s}%`}}}function applyZoom(){const e=document.querySelector(".slider-track"),t=document.querySelector(".time-slider-container"),n=document.getElementById("startThumb"),i=document.getElementById("endThumb"),o=(document.querySelector(".slider-range"),document.getElementById("currentTimeIndicator"));originalTrackWidth||(originalTrackWidth=e.offsetWidth);const d=2**(currentZoomLevel-1);e.style.width=originalTrackWidth*d+"px",e.style.transformOrigin="left";const l=((parseFloat(n.style.left)||0)+(parseFloat(i.style.left)||100))/2/100*e.offsetWidth-t.offsetWidth/2;t.scrollLeft=Math.max(0,l),updateSliderRange(),[n,i,o].forEach((e=>{e&&(e.style.transform="translateY(-50%)")})),updateTicks(d),t.style.overflowX="auto"}function updateSliderRange(){const e=document.getElementById("startThumb"),t=document.getElementById("endThumb"),n=document.querySelector(".slider-range");if(e&&t&&n){const i=parseFloat(e.style.left)||0,o=parseFloat(t.style.left)||100;n.style.left=`${i}%`,n.style.width=o-i+"%"}}function zoomIn(){const e=document.getElementById("startThumb"),t=document.getElementById("endThumb"),n=(parseFloat(e.style.left),parseFloat(t.style.left),document.querySelector(".slider-track").offsetWidth);document.querySelector(".time-slider-container").offsetWidth/n*videoDuration/2>=30&&(currentZoomLevel=currentZoomLevel+1,applyZoom())}function zoomOut(){currentZoomLevel>1&&(currentZoomLevel--,applyZoom(),1===currentZoomLevel)&&(document.querySelector(".slider-track").style.width=`${originalTrackWidth}px`,document.querySelector(".time-slider-container").style.overflowX="hidden")}function setupEventListeners(){const e=document.querySelector(".buttons");e&&e.addEventListener("click",(e=>{"동영상"===e.target.textContent?addVideoInputFields():"이미지"===e.target.textContent&&addImageInputFields()}));const t=document.querySelector(".preview-btn");t&&t.addEventListener("click",(()=>{0!==slideQueue.length?openPreviewWindow():alert("추가된 슬라이드가 없습니다.")})),document.querySelectorAll(".slide").forEach(((e,t)=>{e.addEventListener("click",(()=>{selectSlide(t)}))}));const n=document.querySelector(".group-title input");n&&n.addEventListener("input",(function(){validateInput(this,50)}));const i=document.querySelector(".description textarea");i&&i.addEventListener("input",(function(){validateInput(this,200),autoExpand(this),limitTextareaLines(this,5)}))}function limitTextareaLines(e,t){const n=e.value.split("\n");n.length>t&&(e.value=n.slice(0,t).join("\n"))}function editSlide(e){const t=slideQueue.findIndex((t=>t.id===e));if(-1===t)return;const n=slideQueue[t];currentEditingSlideIndex=t;const{videoId:i,startTime:o,endTime:d,videoLink:l}=n;document.getElementById("mediabox-content").innerHTML=`\n        <div class="video-frame" style="display: block;">\n            <div id="videoPreview"></div>\n        </div>\n        <div class="time-slider-wrapper" style="display: block;">\n            <div class="time-slider-container" style="display: block; overflow-x: auto;">\n                <div class="slider-track" style="width: 100%;">\n                    <div class="slider-range"></div>\n                    <div class="slider-left-thumb" id="startThumb"></div>\n                    <div class="slider-right-thumb" id="endThumb"></div>\n                    <div class="current-time-indicator" id="currentTimeIndicator"></div>\n                </div>\n            </div>\n        </div>\n        <div class="input-group">\n            <input type="text" id="videoLink" placeholder="YouTube 링크" value="${l}" onclick="this.value=''" oninput="handleVideoLinkInput()">\n            <div class="plus-minus-buttons">\n                <button onclick="zoomOut()">-</button>\n                <button onclick="zoomIn()">+</button>\n            </div>\n        </div>\n        <div class="action-buttons" style="display: flex;">\n            <button class="media-select" style="float: left;" onclick="resetMediabox()">미디어 선택</button>\n            <div style="float: right;">\n                <button class="confirm" onclick="updateSlide('${e}')">수정</button>\n            </div>\n        </div>\n    `,player&&player.destroy(),player=new YT.Player("videoPreview",{height:"300",width:"100%",videoId:i,events:{onReady:function(e){fetchVideoDuration(i).then((e=>{n.videoDuration=e,videoDuration=e;const t=o/e*100,i=d/e*100;document.getElementById("startThumb").style.left=`${t}%`,document.getElementById("endThumb").style.left=`${i}%`,setupSlider(t,i),updateSliderRange(),updateLayout(),playSegment(o,d)})).catch((e=>{console.error("Error fetching video duration:",e)}))},onStateChange:onPlayerStateChange}}),showMediabox()}function updateSlide(e){const t=document.getElementById("videoLink").value.trim();let n,i;if(t)({videoId:n,updatedUrl:i}=extractVideoId(t));else{if(!(player&&player.getVideoData&&player.getVideoData().video_id))return;n=player.getVideoData().video_id,i=`https://www.youtube.com/watch?v=${n}`}const o=document.getElementById("startThumb"),d=document.getElementById("endThumb"),l=parseFloat(o.style.left)/100*videoDuration,r=parseFloat(d.style.left)/100*videoDuration,s=slideQueue.findIndex((t=>t.id===e));if(-1===s)return;slideQueue[s]={id:e,type:"video",videoId:n,startTime:l,endTime:r,videoDuration,videoLink:i};const a=document.querySelector(`.slide[data-id="${e}"]`);a.innerHTML=`\n        <img src="https://img.youtube.com/vi/${n}/0.jpg" alt="Video Thumbnail" style="aspect-ratio: 16/9;">\n        <div class="slide-close">&times;</div>\n    `,a.querySelector(".slide-close").addEventListener("click",(()=>{removeSlide(e)})),makeSlidesSortable();const c=document.querySelector(".confirm");c.textContent="확인",c.onclick=()=>addSlide(),document.querySelectorAll(".slide.selected").forEach((e=>{e.classList.remove("selected")})),document.querySelector(".empty-slide").classList.add("selected"),forceUpdateSliderLayout()}function formatDuration(e){return`${Math.floor(e/60)}분 ${Math.floor(e%60)}초`}function forceUpdateSliderLayout(){setTimeout((()=>{const e=new Event("resize");window.dispatchEvent(e)}),0)}function addEmptySlide(){const e=document.querySelector(".slides");if(e.querySelector(".empty-slide"))return;const t=document.createElement("div");t.className="empty-slide",t.innerHTML='<div class="plus-sign">+</div>',t.addEventListener("click",(()=>{document.querySelectorAll(".slide, .empty-slide").forEach((e=>{e.classList.remove("selected")})),t.classList.add("selected"),resetMediabox()})),e.appendChild(t)}function setupEmptySlide(){const e=document.querySelector(".empty-slide");e&&e.addEventListener("click",(()=>{document.querySelectorAll(".slide, .empty-slide").forEach((e=>{e.classList.remove("selected")})),e.classList.add("selected"),resetMediabox()}))}function showMediabox(){const e=document.querySelector(".mediabox");e?e.style.display="block":console.error("Mediabox element not found")}function hideMediabox(){document.querySelector(".mediabox").style.display="none"}function showMediaButtons(){document.getElementById("mediabox-content").innerHTML='\n        <div class="buttons">\n            <button onclick="addVideoInputFields()">동영상</button>\n            <button onclick="addImageInputFields()">이미지</button>\n        </div>\n    ',showMediabox()}function addSlide(){const e=document.getElementById("videoLink").value.trim();let t,n;if(e)({videoId:t,updatedUrl:n}=extractVideoId(e));else{if(!(player&&player.getVideoData&&player.getVideoData().video_id))return;t=player.getVideoData().video_id,n=`https://www.youtube.com/watch?v=${t}`}const i=document.getElementById("startThumb"),o=document.getElementById("endThumb"),d=parseFloat(i.style.left)/100*videoDuration,l=parseFloat(o.style.left)/100*videoDuration,r=createUniqueSlideId();slideQueue.push({id:r,type:"video",videoId:t,startTime:d,endTime:l,videoDuration,videoLink:n});const s=document.querySelector(".slides"),a=document.createElement("div");a.className="slide",a.dataset.id=r,a.innerHTML=`\n        <img src="https://img.youtube.com/vi/${t}/0.jpg" alt="Video Thumbnail" style="aspect-ratio: 16/9;">\n        <div class="slide-close">&times;</div>\n    `,a.addEventListener("click",(()=>handleSlideClick(r)));const c=s.querySelector(".empty-slide");c?s.insertBefore(a,c):s.appendChild(a),a.querySelector(".slide-close").addEventListener("click",(e=>{e.stopPropagation(),removeSlide(r)})),makeSlidesSortable(),document.querySelector(".empty-slide")||addEmptySlide()}function addImageSlide(){const e=document.getElementById("imageInput"),t=parseInt(document.getElementById("imageDuration").value)||5;if(e.files&&e.files[0]){const n=e.files[0],i=new FileReader;i.onload=function(e){const n=e.target.result,i=slideQueue.length;slideQueue.push({type:"image",imageUrl:n,duration:t});const o=document.querySelector(".slides"),d=document.createElement("div");d.className="slide",d.dataset.index=i,d.dataset.type="image",d.innerHTML=`\n                <img src="${n}" alt="Uploaded Image" style="aspect-ratio: 16/9;">\n                <div class="slide-close">&times;</div>\n            `,o.insertBefore(d,o.querySelector(".empty-slide")),d.querySelector(".slide-close").addEventListener("click",(()=>{removeSlide(i)})),makeSlidesSortable(),addEmptySlide()},i.readAsDataURL(n)}else alert("이미지를 선택해주세요.")}function removeSlide(e){const t=document.querySelector(".slides"),n=t.querySelector(`.slide[data-id="${e}"]`);n&&t.removeChild(n),slideQueue=slideQueue.filter((t=>t.id!==e)),makeSlidesSortable(),0===t.querySelectorAll(".slide").length&&addEmptySlide()}function makeSlidesSortable(){const e=document.querySelector(".slides");e.querySelectorAll(".slide:not(.empty-slide)").forEach((e=>{e.setAttribute("draggable",!0),e.addEventListener("dragstart",(()=>{e.classList.add("dragging")})),e.addEventListener("dragend",(()=>{e.classList.remove("dragging"),updateSlideQueue()}))})),e.addEventListener("dragover",(t=>{t.preventDefault();const n=getDragAfterElement(e,t.clientX),i=document.querySelector(".dragging");null==n||n.classList.contains("empty-slide")?e.insertBefore(i,e.querySelector(".empty-slide")):e.insertBefore(i,n)}))}function getDragAfterElement(e,t){return[...e.querySelectorAll(".slide:not(.dragging):not(.empty-slide)")].reduce(((e,n)=>{const i=n.getBoundingClientRect(),o=t-i.left-i.width/2;return o<0&&o>e.offset?{offset:o,element:n}:e}),{offset:Number.NEGATIVE_INFINITY}).element}function updateSlideQueue(){const e=document.querySelectorAll(".slide:not(.empty-slide)"),t=Array.from(e).map((e=>{const t=e.dataset.id;return slideQueue.find((e=>e.id===t))}));slideQueue=t}function updateSlideIndices(){document.querySelectorAll(".slide:not(.empty-slide)").forEach(((e,t)=>{e.dataset.index=t}))}function handleSlideClick(e){selectSlide(e)}function selectSlide(e){document.querySelectorAll(".slide, .empty-slide").forEach((e=>{e.classList.remove("selected")}));const t=document.querySelector(`.slide[data-id="${e}"]`);t&&(t.classList.add("selected"),editSlide(e))}function openPreviewWindow(){const e=document.querySelector(".group-title input").value,t=document.querySelector(".description textarea").value,n=`preview.html?slideQueue=${encodeURIComponent(JSON.stringify(slideQueue))}&groupTitle=${encodeURIComponent(e)}&description=${encodeURIComponent(t)}`;console.log("Opening preview window with URL:",n),player&&"function"==typeof player.pauseVideo&&player.pauseVideo(),window.open(n,"previewWindow","width=800,height=860")}function updateLayout(){document.getElementById("mediabox-content");const e=document.querySelector(".video-frame"),t=document.querySelector(".time-slider-wrapper"),n=document.querySelector(".time-slider-container"),i=document.querySelector(".slider-track");if(e&&t&&n&&i){const o=e.offsetWidth;t.style.width=`${o}px`,n.style.width=`${o}px`,i.style.width=o-40+"px"}adjustSliderTrackWidth()}function validateInput(e,t){e.value.length>t&&(e.value=e.value.slice(0,t))}function autoExpand(e){e.style.height="auto",e.style.height=`${e.scrollHeight}px`}function updateTicks(e){document.querySelector(".slider-track").style.setProperty("--zoom-factor",e)}document.addEventListener("DOMContentLoaded",(()=>{setupEventListeners(),hideMediabox(),window.addEventListener("resize",updateLayout),addEmptySlide(),setupEmptySlide()})),endThumb.addEventListener("mousedown",(function(e){e.preventDefault(),document.addEventListener("mousemove",moveEnd),document.addEventListener("mouseup",stopMove)}));